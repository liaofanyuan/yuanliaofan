<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    {%- include head.html -%}
    <link rel="stylesheet" href="{{ '/assets/css/learn-mode.css' | relative_url }}?v={{ site.time | date: '%s' }}">
    <title>{{ page.title }} - è‡ªä¸»å­¦ä¹ æ¨¡å¼</title>
    <style>
        /* å…³é”®å†…è”æ ·å¼ - ç¡®ä¿é¡µé¢æ­£ç¡®æ˜¾ç¤º */
        .summary-overlay { display: none !important; }
        .summary-overlay.show { display: flex !important; }
        .quiz-view.hidden, .complete-view.hidden { display: none !important; }
        .module-content { background: #fff !important; border: 2px solid #e5e7eb !important; border-radius: 8px !important; padding: 3rem !important; }
        .module-header { border-left: 6px solid #1f2937 !important; background: linear-gradient(90deg, rgba(31,41,55,0.05), transparent) !important; padding: 1.25rem 1.5rem !important; margin-bottom: 2.5rem !important; }
        .btn { padding: 0.875rem 1.75rem !important; border-radius: 6px !important; font-weight: 600 !important; cursor: pointer !important; }
        .btn-primary { background: #1f2937 !important; color: #fff !important; border: 2px solid #1f2937 !important; }
        .btn-outline { background: #fff !important; color: #374151 !important; border: 2px solid #d1d5db !important; }
    </style>
</head>
<body>
    <div class="book">
        {%- include toc-date.html -%}

        <div class="book-body">
            <div class="book-header" role="navigation">
                <h1>
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <a href=".">{{ page.title | escape }}</a>
                </h1>
            </div>

            <div class="body-inner">
                <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
                <button class="theme-toggle" id="theme-toggle">
                    <span id="theme-icon">ğŸŒ™</span>
                    <span id="theme-text">æš—è‰²æ¨¡å¼</span>
                </button>

                <div class="learn-container" id="learn-app" data-ready="false">
                    
                    <!-- è¿›åº¦æ¡ -->
                    <div class="progress-wrapper" id="progress-wrapper">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-text" id="progress-text">0/6 æ¨¡å—</div>
                    </div>

                    <!-- æ¨¡å—è§†å›¾ -->
                    <div class="module-view" id="module-view">
                        <header class="module-header" id="module-header">
                            <div class="module-title-wrapper">
                                <h2 class="module-title" id="module-title"></h2>
                                <span class="module-indicator" id="module-indicator"></span>
                            </div>
                        </header>

                        <article class="module-content" id="module-content">
                            <!-- åŠ¨æ€åŠ è½½å†…å®¹ -->
                        </article>

                        <footer class="module-actions">
                            <button class="btn btn-outline" id="btn-prev">
                                â† å›åˆ°ä¸Šä¸€æ¨¡å—
                            </button>
                            <button class="btn btn-outline" id="btn-summary">
                                æŸ¥çœ‹æœ¬æ¨¡å—å¤§çº²
                            </button>
                            <button class="btn btn-primary" id="btn-next">
                                æˆ‘å·²ç†è§£ï¼Œè¿›å…¥ä¸‹ä¸€æ¨¡å— â†’
                            </button>
                        </footer>
                    </div>

                    <!-- å¤§çº²å¼¹çª— -->
                    <div class="summary-overlay" id="summary-overlay">
                        <div class="summary-card">
                            <div class="summary-header">
                                <h3 id="summary-title">æœ¬æ¨¡å—è¦ç‚¹æ€»ç»“</h3>
                                <button class="btn-close" id="btn-close-summary">
                                    <i class="fa fa-times"></i>
                                </button>
                            </div>
                            <div class="summary-body">
                                <ul id="summary-points"></ul>
                                <div class="summary-takeaway">
                                    <strong>æ ¸å¿ƒè¦ç‚¹ï¼š</strong>
                                    <p id="summary-key"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æµ‹è¯•è§†å›¾ -->
                    <div class="quiz-view hidden" id="quiz-view">
                        <div class="quiz-header">
                            <h2>å­¦ä¹ æµ‹è¯•</h2>
                            <p class="quiz-subtitle">æ£€éªŒä½ å¯¹ã€Šç«‹å‘½ä¹‹å­¦ã€‹çš„ç†è§£æ·±åº¦</p>
                        </div>

                        <div class="quiz-progress">
                            <span id="quiz-progress-text">ç¬¬ 1/6 é¢˜</span>
                        </div>

                        <div class="quiz-question-card" id="quiz-card">
                            <div class="quiz-question" id="quiz-question"></div>
                            <div class="quiz-options" id="quiz-options"></div>
                            <div class="quiz-feedback hidden" id="quiz-feedback"></div>
                            <div class="quiz-actions">
                                <button class="btn btn-primary" id="btn-submit-answer">æäº¤ç­”æ¡ˆ</button>
                                <button class="btn btn-primary hidden" id="btn-next-question">ä¸‹ä¸€é¢˜</button>
                            </div>
                        </div>
                    </div>

                    <!-- å®Œæˆé¡µé¢ -->
                    <div class="complete-view hidden" id="complete-view">
                        <div class="complete-card">
                            <div class="complete-icon">âœ“</div>
                            <h2>æ­å–œå®Œæˆã€Šç«‹å‘½ä¹‹å­¦ã€‹</h2>
                            <p class="complete-summary">æœ¬ç« æ ¸å¿ƒï¼šå‘½ç”±æˆ‘ä½œï¼Œç¦è‡ªå·±æ±‚</p>
                            <div class="complete-stats">
                                <div class="stat-item">
                                    <span class="stat-label">æµ‹è¯•æ­£ç¡®ç‡</span>
                                    <span class="stat-value" id="complete-score">0%</span>
                                </div>
                            </div>
                            <div class="complete-actions">
                                <button class="btn btn-outline" id="btn-review-modules">
                                    é‡æ–°å­¦ä¹ æŸä¸€æ¨¡å—
                                </button>
                                <a href="{{ page.originalPath }}" class="btn btn-primary">
                                    æŸ¥çœ‹å®Œæ•´åŸæ–‡
                                </a>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- è¿”å›åŸæ–‡å…¥å£ -->
                <div class="mode-switcher">
                    <a href="{{ page.originalPath }}" class="switch-link">
                        <i class="fa fa-book"></i> åˆ‡æ¢åˆ°å®Œæ•´é˜…è¯»æ¨¡å¼
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç¡®ä¿æ•°æ®åœ¨JSåˆå§‹åŒ–å‰åŠ è½½
        window.LESSON_DATA = {{ site.data.lessons[page.lessonId] | jsonify }};
        window.LESSON_CONTENT = {{ page.content | jsonify }};
    </script>
    <script src="{{ '/assets/js/learn-mode.js' | relative_url }}"></script>
    <script>
        // æ£€æµ‹ learn-mode.css æ˜¯å¦æ­£ç¡®åŠ è½½ï¼ˆé˜²æ­¢ PJAX å¯¼èˆªé—®é¢˜ï¼‰
        (function() {
            var cssLoaded = false;
            var sheets = document.styleSheets;
            for (var i = 0; i < sheets.length; i++) {
                try {
                    if (sheets[i].href && sheets[i].href.indexOf('learn-mode.css') > -1) {
                        cssLoaded = true;
                        break;
                    }
                } catch (e) {}
            }
            if (!cssLoaded && !window._learnModeReloaded) {
                window._learnModeReloaded = true;
                window.location.reload();
            }
        })();
    </script>
    
    {%- include footer.html -%}
</body>
</html>
